# TelegramBot

## Основные требования:

1. **Паттерн команда**: Для выполнения команд, полученных от пользователей, должен быть использован паттерн команда.
2. **Обработка ошибок**: Система должна уметь обрабатывать ошибки, такие как:
    - Ошибки, полученные от других сервисов.
    - Ошибки неправильных команд.
3. **Взаимодействие с Telegram**: Система должна уметь:
    - Получать сообщения от Telegram.
    - Отправлять сообщения в Telegram.
4. **Отмена команды**: Система должна уметь отменять выполнение текущей команды.
5. **Разные типы ответов**: Необходимо учитывать, что система должна возвращать клиенту различные типы ответов.
6. **Обработка не только строк**: Необходимо учитывать, что клиент может передавать не только строки.
7. **Взаимодействие с другими сервисами**: Система взаимодействует с другими сервисами через **Feign**, а именно:
    - `category`
    - `category-tree`
8. **Делегирование управления категориями**: Команды, которые занимаются управлением категориями, должны делегировать выполнение этих запросов в соответствующие сервисы.


# Идея

Для гибкости системы будет создан несколько классов, отвечающих за отправку сообщений в Telegram:

- **TextResponseSender** — для отправки текстовых сообщений.
- **ErrorSender** — для отправки сообщений об ошибках.
- **FileSender** — для отправки файлов.

Каждая команда будет возвращать объект `TelegramResponse`, который хранит данные и выполняет отправку сообщения в Telegram. Таким образом, из любой команды мы можем возвращать различные типы ответов.

## Структура команд:

- Каждая команда может содержать **step**. Это означает, что выполнение одной команды может не завершаться на самой команде, а будет делегировано следующему шагу.
- Такой подход необходим для того, чтобы получать дополнительные данные от пользователя в процессе выполнения одной команды.

-Так же существуют одно шаговые команды , которые выполняются в самих классах командах, а для многошаговых был создан общий класс stepcommand который делегируют выполнение команды в step классы

Все команды будут работать по одинаковому принципу, поэтому нет необходимости детально описывать каждую команду отдельно. Вместо этого следует акцентировать внимание на общей идее работы системы.


# Описание работы одной команды

## 1. Команда
Команда — это объект, который управляет последовательностью шагов выполнения определенной задачи. Она обрабатывает сообщения пользователя, проходя через несколько шагов.

## 2. Шаги команды
Каждый шаг представляет собой конкретное действие в рамках команды. Например, на первом шаге пользователь должен ввести имя категории, которую он хочет добавить. Каждый шаг имеет свою логику обработки, и, в зависимости от результата, может переходить к следующему шагу или завершать выполнение команды.

## 3. Процесс выполнения команды
- **Получение сообщения**: Когда система получает сообщение от пользователя, она определяет, какую команду выполняет пользователь. Если команда не существует, система пытается создать новую команду, используя это сообщение.
- **Определение шага**: После того как система определила команду, она проверяет, какой шаг необходимо выполнить.
- **Переход к следующему шагу**: Если текущий шаг завершен, система проверяет, есть ли следующий шаг. Если он есть, команда переходит к следующему шагу и может запросить ввод новых данных, если это необходимо.
- **Завершение команды**: Если шагов больше нет, команда завершается, и выполнение задачи считается завершенным.

## 4. Ответ, который возвращает команда
Команда использует интерфейс для создания ответов, отправляемых пользователю в Telegram. Каждый шаг может вернуть объект, реализующий этот интерфейс. Типы ответов могут включать текстовые сообщения или файлы.

- Когда команда обрабатывает сообщение, она создает объект `TelegramResponseSender`, который содержит ответ для пользователя.
- Этот объект отправляется пользователю через Telegram API с помощью метода `sendResponse`, предоставляя необходимую информацию или запрашивая дальнейшие действия от пользователя.

## 5. Обработчик обновлений
Обработчик обновлений получает сообщения от пользователя, идентифицирует текущую команду и управляет процессом выполнения команды.

- Если команда уже существует для пользователя, обработчик продолжает её выполнение.
- Если команда не существует, создается новая команда, которая затем добавляется в систему.

## 6. Завершение команды
Когда все шаги команды успешно завершены, команда считается выполненной. После этого команда удаляется из системы, освобождая ресурсы.

## 7. Обработка ошибок и отмена
В случае ошибок или отмены пользователем, система может предложить повторно ввести данные или завершить процесс, при этом возвращая соответствующие сообщения пользователю.
